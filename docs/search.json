[
  {
    "objectID": "Homework9.html",
    "href": "Homework9.html",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# Load necessary libraries\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(lubridate)\nlibrary(janitor)\nlibrary(baguette)\nlibrary(glmnet)\nlibrary(ranger)\nlibrary(rpart.plot)\n\n\n\n\nbike_data_raw &lt;- read_csv(\"SeoulBikeData.csv\", \n                          locale = locale(encoding = \"latin1\"))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): Date, Seasons, Holiday, Functioning Day\ndbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\n\n\n\n\n# 1. Check for missingness\nprint(colSums(is.na(bike_data_raw)))\n\n                      Date          Rented Bike Count \n                         0                          0 \n                      Hour           Temperature(°C) \n                         0                          0 \n               Humidity(%)           Wind speed (m/s) \n                         0                          0 \n          Visibility (10m) Dew point temperature(°C) \n                         0                          0 \n   Solar Radiation (MJ/m2)               Rainfall(mm) \n                         0                          0 \n             Snowfall (cm)                    Seasons \n                         0                          0 \n                   Holiday            Functioning Day \n                         0                          0 \n\n\nAll columns are 0 : There is no missing.\n\n# 2. Check column types and values\nglimpse(bike_data_raw)\n\nRows: 8,760\nColumns: 14\n$ Date                        &lt;chr&gt; \"01/12/2017\", \"01/12/2017\", \"01/12/2017\", …\n$ `Rented Bike Count`         &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930…\n$ Hour                        &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, …\n$ `Temperature(°C)`           &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, …\n$ `Humidity(%)`               &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24…\n$ `Wind speed (m/s)`          &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.…\n$ `Visibility (10m)`          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, …\n$ `Dew point temperature(°C)` &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, …\n$ `Solar Radiation (MJ/m2)`   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, …\n$ `Rainfall(mm)`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ `Snowfall (cm)`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ Seasons                     &lt;chr&gt; \"Winter\", \"Winter\", \"Winter\", \"Winter\", \"W…\n$ Holiday                     &lt;chr&gt; \"No Holiday\", \"No Holiday\", \"No Holiday\", …\n$ `Functioning Day`           &lt;chr&gt; \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", …\n\nsummary(bike_data_raw |&gt; select(where(is.numeric)))\n\n Rented Bike Count      Hour       Temperature(°C)  Humidity(%)   \n Min.   :   0.0    Min.   : 0.00   Min.   :-17.80   Min.   : 0.00  \n 1st Qu.: 191.0    1st Qu.: 5.75   1st Qu.:  3.50   1st Qu.:42.00  \n Median : 504.5    Median :11.50   Median : 13.70   Median :57.00  \n Mean   : 704.6    Mean   :11.50   Mean   : 12.88   Mean   :58.23  \n 3rd Qu.:1065.2    3rd Qu.:17.25   3rd Qu.: 22.50   3rd Qu.:74.00  \n Max.   :3556.0    Max.   :23.00   Max.   : 39.40   Max.   :98.00  \n Wind speed (m/s) Visibility (10m) Dew point temperature(°C)\n Min.   :0.000    Min.   :  27     Min.   :-30.600           \n 1st Qu.:0.900    1st Qu.: 940     1st Qu.: -4.700           \n Median :1.500    Median :1698     Median :  5.100           \n Mean   :1.725    Mean   :1437     Mean   :  4.074           \n 3rd Qu.:2.300    3rd Qu.:2000     3rd Qu.: 14.800           \n Max.   :7.400    Max.   :2000     Max.   : 27.200           \n Solar Radiation (MJ/m2)  Rainfall(mm)     Snowfall (cm)    \n Min.   :0.0000          Min.   : 0.0000   Min.   :0.00000  \n 1st Qu.:0.0000          1st Qu.: 0.0000   1st Qu.:0.00000  \n Median :0.0100          Median : 0.0000   Median :0.00000  \n Mean   :0.5691          Mean   : 0.1487   Mean   :0.07507  \n 3rd Qu.:0.9300          3rd Qu.: 0.0000   3rd Qu.:0.00000  \n Max.   :3.5200          Max.   :35.0000   Max.   :8.80000  \n\nprint(map(bike_data_raw |&gt; select(where(is.character), -Date), unique))\n\n$Seasons\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\n$Holiday\n[1] \"No Holiday\" \"Holiday\"   \n\n$`Functioning Day`\n[1] \"Yes\" \"No\" \n\n\n\n# 3, 4, 5. Convert Date, Convert to Factors, Rename\nbike_data_cleaned &lt;- bike_data_raw |&gt;\n  mutate(\n    Date = dmy(Date), # 3. Convert the Date column into an actual date \n    Seasons = factor(Seasons), # 4: Turn the character variables \n    Holiday = factor(Holiday), # 4: Turn the character variables \n  ) |&gt;\n  clean_names() |&gt; # 5: Rename all the variables to have easy to use names \n  mutate(\n    functioning_day = factor(functioning_day) # 4: Turn the character variables \n  )\n\nglimpse(bike_data_cleaned)\n\nRows: 8,760\nColumns: 14\n$ date                    &lt;date&gt; 2017-12-01, 2017-12-01, 2017-12-01, 2017-12-0…\n$ rented_bike_count       &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930, 49…\n$ hour                    &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …\n$ temperature_c           &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, -7.4…\n$ humidity_percent        &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24, 21…\n$ wind_speed_m_s          &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.1, 0…\n$ visibility_10m          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000…\n$ dew_point_temperature_c &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, -19.…\n$ solar_radiation_mj_m2   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00…\n$ rainfall_mm             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ snowfall_cm             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ seasons                 &lt;fct&gt; Winter, Winter, Winter, Winter, Winter, Winter…\n$ holiday                 &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday…\n$ functioning_day         &lt;fct&gt; Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Y…\n\n\n\n\n\n\n# 6: Create summary statistics (especially related to the bike rental count)\nprint(\n  bike_data_cleaned |&gt;\n    group_by(functioning_day) |&gt;\n    summarize(\n      count = n(),\n      min_bikes = min(rented_bike_count),\n      mean_bikes = mean(rented_bike_count),\n      max_bikes = max(rented_bike_count)\n    )\n)\n\n# A tibble: 2 × 5\n  functioning_day count min_bikes mean_bikes max_bikes\n  &lt;fct&gt;           &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;\n1 No                295         0         0          0\n2 Yes              8465         2       729.      3556\n\n# 6: Subset the data appropriately\nbike_data_functional &lt;- bike_data_cleaned |&gt;\n  filter(functioning_day == \"Yes\")\n\nsummary(bike_data_functional)\n\n      date            rented_bike_count      hour       temperature_c   \n Min.   :2017-12-01   Min.   :   2.0    Min.   : 0.00   Min.   :-17.80  \n 1st Qu.:2018-02-27   1st Qu.: 214.0    1st Qu.: 6.00   1st Qu.:  3.00  \n Median :2018-05-28   Median : 542.0    Median :12.00   Median : 13.50  \n Mean   :2018-05-28   Mean   : 729.2    Mean   :11.51   Mean   : 12.77  \n 3rd Qu.:2018-08-24   3rd Qu.:1084.0    3rd Qu.:18.00   3rd Qu.: 22.70  \n Max.   :2018-11-30   Max.   :3556.0    Max.   :23.00   Max.   : 39.40  \n humidity_percent wind_speed_m_s  visibility_10m dew_point_temperature_c\n Min.   : 0.00    Min.   :0.000   Min.   :  27   Min.   :-30.600        \n 1st Qu.:42.00    1st Qu.:0.900   1st Qu.: 935   1st Qu.: -5.100        \n Median :57.00    Median :1.500   Median :1690   Median :  4.700        \n Mean   :58.15    Mean   :1.726   Mean   :1434   Mean   :  3.945        \n 3rd Qu.:74.00    3rd Qu.:2.300   3rd Qu.:2000   3rd Qu.: 15.200        \n Max.   :98.00    Max.   :7.400   Max.   :2000   Max.   : 27.200        \n solar_radiation_mj_m2  rainfall_mm       snowfall_cm        seasons    \n Min.   :0.0000        Min.   : 0.0000   Min.   :0.00000   Autumn:1937  \n 1st Qu.:0.0000        1st Qu.: 0.0000   1st Qu.:0.00000   Spring:2160  \n Median :0.0100        Median : 0.0000   Median :0.00000   Summer:2208  \n Mean   :0.5679        Mean   : 0.1491   Mean   :0.07768   Winter:2160  \n 3rd Qu.:0.9300        3rd Qu.: 0.0000   3rd Qu.:0.00000                \n Max.   :3.5200        Max.   :35.0000   Max.   :8.80000                \n       holiday     functioning_day\n Holiday   : 408   No :   0       \n No Holiday:8057   Yes:8465       \n                                  \n                                  \n                                  \n                                  \n\nbike_data_functional_no &lt;- bike_data_cleaned |&gt;\n  filter(functioning_day == \"No\")\n\nsummary(bike_data_functional_no)\n\n      date            rented_bike_count      hour      temperature_c  \n Min.   :2018-04-11   Min.   :0         Min.   : 0.0   Min.   : 5.20  \n 1st Qu.:2018-09-19   1st Qu.:0         1st Qu.: 5.0   1st Qu.:12.30  \n Median :2018-10-02   Median :0         Median :11.0   Median :16.30  \n Mean   :2018-09-12   Mean   :0         Mean   :11.3   Mean   :16.09  \n 3rd Qu.:2018-10-09   3rd Qu.:0         3rd Qu.:17.0   3rd Qu.:19.35  \n Max.   :2018-11-09   Max.   :0         Max.   :23.0   Max.   :26.50  \n humidity_percent wind_speed_m_s  visibility_10m dew_point_temperature_c\n Min.   :21.00    Min.   :0.000   Min.   : 201   Min.   :-7.00          \n 1st Qu.:49.00    1st Qu.:0.900   1st Qu.:1055   1st Qu.: 5.30          \n Median :62.00    Median :1.500   Median :1814   Median : 7.80          \n Mean   :60.49    Mean   :1.697   Mean   :1522   Mean   : 7.77          \n 3rd Qu.:73.00    3rd Qu.:2.350   3rd Qu.:2000   3rd Qu.:11.00          \n Max.   :96.00    Max.   :5.300   Max.   :2000   Max.   :16.10          \n solar_radiation_mj_m2  rainfall_mm       snowfall_cm   seasons   \n Min.   :0.0000        Min.   : 0.0000   Min.   :0    Autumn:247  \n 1st Qu.:0.0000        1st Qu.: 0.0000   1st Qu.:0    Spring: 48  \n Median :0.0000        Median : 0.0000   Median :0    Summer:  0  \n Mean   :0.6048        Mean   : 0.1363   Mean   :0    Winter:  0  \n 3rd Qu.:1.0650        3rd Qu.: 0.0000   3rd Qu.:0                \n Max.   :3.3200        Max.   :18.0000   Max.   :0                \n       holiday    functioning_day\n Holiday   : 24   No :295        \n No Holiday:271   Yes:  0        \n                                 \n                                 \n                                 \n                                 \n\n\nIf the bike is not functioning, the rented bike count is always 0.\nSo we will focus on the data where the bike is functioning for further analysis.\n\n# 7: To simplify our analysis, we’ll summarize across the hours\nbike_data_daily &lt;- bike_data_functional |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(\n    # Find the sum of rented_bike_count, rainfall, and snowfall\n    rented_bike_count_sum = sum(rented_bike_count),\n    rainfall_sum_mm = sum(rainfall_mm),\n    snowfall_sum_cm = sum(snowfall_cm),\n    \n    # Find the mean of all the weather related variables\n    temperature_mean_c = mean(temperature_c),\n    humidity_mean_percent = mean(humidity_percent),\n    wind_speed_mean_m_s = mean(wind_speed_m_s),\n    visibility_mean_10m = mean(visibility_10m),\n    dew_point_temperature_mean_c = mean(dew_point_temperature_c),\n    solar_radiation_mean_mj_m2 = mean(solar_radiation_mj_m2),\n    \n    .groups = 'drop' \n  )\n\nglimpse(bike_data_daily)\n\nRows: 353\nColumns: 12\n$ date                         &lt;date&gt; 2017-12-01, 2017-12-02, 2017-12-03, 2017…\n$ seasons                      &lt;fct&gt; Winter, Winter, Winter, Winter, Winter, W…\n$ holiday                      &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Ho…\n$ rented_bike_count_sum        &lt;dbl&gt; 9539, 8523, 7222, 8729, 8307, 6669, 8549,…\n$ rainfall_sum_mm              &lt;dbl&gt; 0.0, 0.0, 4.0, 0.1, 0.0, 1.3, 0.0, 0.0, 0…\n$ snowfall_sum_cm              &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 8.6, 10.4, 0.0, …\n$ temperature_mean_c           &lt;dbl&gt; -2.45416667, 1.32500000, 4.87500000, -0.3…\n$ humidity_mean_percent        &lt;dbl&gt; 45.87500, 61.95833, 81.54167, 52.50000, 3…\n$ wind_speed_mean_m_s          &lt;dbl&gt; 1.5375000, 1.7125000, 1.6125000, 3.450000…\n$ visibility_mean_10m          &lt;dbl&gt; 1870.7500, 1471.0833, 455.7500, 1362.8333…\n$ dew_point_temperature_mean_c &lt;dbl&gt; -13.5458333, -5.7166667, 1.8833333, -9.92…\n$ solar_radiation_mean_mj_m2   &lt;dbl&gt; 0.24875000, 0.26375000, 0.12541667, 0.282…\n\n\n\n# 8: Recreate my basic summary stats\nsummary(bike_data_daily)\n\n      date              seasons         holiday    rented_bike_count_sum\n Min.   :2017-12-01   Autumn:81   Holiday   : 17   Min.   :  977        \n 1st Qu.:2018-02-27   Spring:90   No Holiday:336   1st Qu.: 6967        \n Median :2018-05-28   Summer:92                    Median :18563        \n Mean   :2018-05-28   Winter:90                    Mean   :17485        \n 3rd Qu.:2018-08-24                                3rd Qu.:26285        \n Max.   :2018-11-30                                Max.   :36149        \n rainfall_sum_mm  snowfall_sum_cm  temperature_mean_c humidity_mean_percent\n Min.   : 0.000   Min.   : 0.000   Min.   :-14.738    Min.   :22.25        \n 1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.:  3.304    1st Qu.:47.58        \n Median : 0.000   Median : 0.000   Median : 13.738    Median :57.17        \n Mean   : 3.576   Mean   : 1.863   Mean   : 12.776    Mean   :58.17        \n 3rd Qu.: 0.500   3rd Qu.: 0.000   3rd Qu.: 22.592    3rd Qu.:67.71        \n Max.   :95.500   Max.   :78.700   Max.   : 33.742    Max.   :95.88        \n wind_speed_mean_m_s visibility_mean_10m dew_point_temperature_mean_c\n Min.   :0.6625      Min.   : 214.3      Min.   :-27.750             \n 1st Qu.:1.3042      1st Qu.:1087.0      1st Qu.: -5.188             \n Median :1.6583      Median :1557.8      Median :  4.612             \n Mean   :1.7261      Mean   :1434.0      Mean   :  3.954             \n 3rd Qu.:1.9542      3rd Qu.:1874.3      3rd Qu.: 14.921             \n Max.   :4.0000      Max.   :2000.0      Max.   : 25.038             \n solar_radiation_mean_mj_m2\n Min.   :0.02917           \n 1st Qu.:0.28333           \n Median :0.56500           \n Mean   :0.56773           \n 3rd Qu.:0.82000           \n Max.   :1.21667           \n\n# Plot: Rented Bike Count vs. Mean Temperature\nplot_temp &lt;- bike_data_daily |&gt;\n  ggplot(aes(x = temperature_mean_c , y = rented_bike_count_sum)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"blue\") +\n  labs(\n    title = \"Daily Bike Rentals vs. Mean Temperature\",\n    x = \"Mean Temperature (C)\",\n    y = \"Sum of Daily Bike Rentals\"\n  )\nprint(plot_temp)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n#  correlation between my numeric variables\ncor_matrix &lt;- bike_data_daily |&gt;\n  select(where(is.numeric)) |&gt;\n  cor()\nprint(round(cor_matrix, 2))\n\n                             rented_bike_count_sum rainfall_sum_mm\nrented_bike_count_sum                         1.00           -0.24\nrainfall_sum_mm                              -0.24            1.00\nsnowfall_sum_cm                              -0.27           -0.02\ntemperature_mean_c                            0.75            0.14\nhumidity_mean_percent                         0.04            0.53\nwind_speed_mean_m_s                          -0.19           -0.10\nvisibility_mean_10m                           0.17           -0.22\ndew_point_temperature_mean_c                  0.65            0.26\nsolar_radiation_mean_mj_m2                    0.74           -0.32\n                             snowfall_sum_cm temperature_mean_c\nrented_bike_count_sum                  -0.27               0.75\nrainfall_sum_mm                        -0.02               0.14\nsnowfall_sum_cm                         1.00              -0.27\ntemperature_mean_c                     -0.27               1.00\nhumidity_mean_percent                   0.07               0.40\nwind_speed_mean_m_s                     0.02              -0.26\nvisibility_mean_10m                    -0.10               0.00\ndew_point_temperature_mean_c           -0.21               0.96\nsolar_radiation_mean_mj_m2             -0.23               0.55\n                             humidity_mean_percent wind_speed_mean_m_s\nrented_bike_count_sum                         0.04               -0.19\nrainfall_sum_mm                               0.53               -0.10\nsnowfall_sum_cm                               0.07                0.02\ntemperature_mean_c                            0.40               -0.26\nhumidity_mean_percent                         1.00               -0.23\nwind_speed_mean_m_s                          -0.23                1.00\nvisibility_mean_10m                          -0.56                0.21\ndew_point_temperature_mean_c                  0.63               -0.29\nsolar_radiation_mean_mj_m2                   -0.27                0.10\n                             visibility_mean_10m dew_point_temperature_mean_c\nrented_bike_count_sum                       0.17                         0.65\nrainfall_sum_mm                            -0.22                         0.26\nsnowfall_sum_cm                            -0.10                        -0.21\ntemperature_mean_c                          0.00                         0.96\nhumidity_mean_percent                      -0.56                         0.63\nwind_speed_mean_m_s                         0.21                        -0.29\nvisibility_mean_10m                         1.00                        -0.15\ndew_point_temperature_mean_c               -0.15                         1.00\nsolar_radiation_mean_mj_m2                  0.27                         0.38\n                             solar_radiation_mean_mj_m2\nrented_bike_count_sum                              0.74\nrainfall_sum_mm                                   -0.32\nsnowfall_sum_cm                                   -0.23\ntemperature_mean_c                                 0.55\nhumidity_mean_percent                             -0.27\nwind_speed_mean_m_s                                0.10\nvisibility_mean_10m                                0.27\ndew_point_temperature_mean_c                       0.38\nsolar_radiation_mean_mj_m2                         1.00\n\n\n\n\n\n\n\nset.seed(10)\nbike_split &lt;- initial_split(bike_data_daily, prop = 0.75, strata = seasons)\nbike_train &lt;- training(bike_split)\nbike_test &lt;- testing(bike_split)\nbike_CV_folds &lt;- vfold_cv(bike_train, v = 10, strata = seasons)\n\n\n\n\n\nMLR_recipe1 &lt;- recipe(rented_bike_count_sum ~ ., data = bike_train) |&gt;\n  # Ignore the date variable for modeling\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \n                                        \"weekend\", \"weekday\"))) |&gt;\n  step_rm(date, date_dow) |&gt; \n  # Standardize the numeric variables since their scales are pretty different.\n  step_normalize(all_numeric_predictors()) |&gt;\n  # Create dummy variables for the seasons, holiday, and our new day type variable\n  step_dummy(all_nominal_predictors())\n\n\n\n\n\n# A. LASSO Model\nlasso_spec &lt;- linear_reg(penalty = tune(), mixture = 1) |&gt;\n  set_engine(\"glmnet\")\n\n# B. Regression Tree Model\ntree_spec &lt;- decision_tree(cost_complexity = tune(), tree_depth = tune(), min_n = tune()) |&gt;\n  set_engine(\"rpart\") |&gt;\n  set_mode(\"regression\")\n\n# C. Bagged Tree Model\nbag_spec &lt;- bag_tree(cost_complexity = tune(), tree_depth = tune(), min_n = tune()) |&gt;\n  set_engine(\"rpart\", times = 50) |&gt;\n  set_mode(\"regression\")\n\n# D. Random Forest Model\nrf_spec &lt;- rand_forest(mtry = tune(), min_n = tune(), trees = 1000) |&gt;\n  set_engine(\"ranger\", importance = \"impurity\") |&gt;\n  set_mode(\"regression\")\n\n\n\n\n\nlasso_wkf &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(lasso_spec)\ntree_wkf  &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(tree_spec)\nbag_wkf   &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(bag_spec)\nrf_wkf    &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(rf_spec)\n\n\n\n\n\n# Setting up grids\nlasso_grid &lt;- grid_regular(penalty(), levels = 50)\ntree_grid  &lt;- grid_regular(cost_complexity(), tree_depth(), min_n(), levels = 5)\nbag_grid   &lt;- grid_regular(cost_complexity(), tree_depth(), min_n(), levels = 5)\nrf_grid    &lt;- grid_regular(mtry(range = c(1, 10)), min_n(), levels = 5)\n\n# Tune Models\nlasso_res &lt;- tune_grid(lasso_wkf, resamples = bike_CV_folds, grid = lasso_grid)\ntree_res  &lt;- tune_grid(tree_wkf,  resamples = bike_CV_folds, grid = tree_grid)\nbag_res   &lt;- tune_grid(bag_wkf,   resamples = bike_CV_folds, grid = bag_grid)\n\nRegistered S3 method overwritten by 'butcher':\n  method                 from    \n  as.character.dev_topic generics\n\n\n→ A | warning: There was 1 warning in `dplyr::mutate()`.\n               ℹ In argument: `model = iter(...)`.\n               Caused by warning:\n               ! package 'future' was built under R version 4.5.2\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\nrf_res    &lt;- tune_grid(rf_wkf,    resamples = bike_CV_folds, grid = rf_grid)\n\n\n\n\n\n# Select best parameters for each model \nbest_lasso &lt;- select_best(lasso_res, metric = \"rmse\")\nfinal_lasso_wkf &lt;- finalize_workflow(lasso_wkf, best_lasso)\nfinal_lasso_fit &lt;- last_fit(final_lasso_wkf, bike_split)\n\nbest_tree  &lt;- select_best(tree_res, metric = \"rmse\")\nfinal_tree_wkf  &lt;- finalize_workflow(tree_wkf, best_tree)\nfinal_tree_fit  &lt;- last_fit(final_tree_wkf, bike_split)\n\nbest_bag   &lt;- select_best(bag_res, metric = \"rmse\")\nfinal_bag_wkf   &lt;- finalize_workflow(bag_wkf, best_bag) \nfinal_bag_fit   &lt;- last_fit(final_bag_wkf, bike_split)\n\nbest_rf    &lt;- select_best(rf_res, metric = \"rmse\")\nfinal_rf_wkf    &lt;- finalize_workflow(rf_wkf, best_rf)\nfinal_rf_fit    &lt;- last_fit(final_rf_wkf, bike_split)\n\n\n\n\n\nMLR_recipe3 &lt;- MLR_recipe1 |&gt;\n  step_interact(~ starts_with(\"seasons_\"):starts_with(\"holiday_\")) |&gt;\n  step_interact(~ starts_with(\"seasons_\"):temperature_mean_c) |&gt;\n  step_interact(~ temperature_mean_c:rainfall_sum_mm) |&gt;\n  step_poly(rainfall_sum_mm, snowfall_sum_cm, temperature_mean_c, humidity_mean_percent,\n            wind_speed_mean_m_s, visibility_mean_10m, dew_point_temperature_mean_c,\n            solar_radiation_mean_mj_m2, degree = 2)\n\nMLR_wkf3 &lt;- workflow() |&gt; add_recipe(MLR_recipe3) |&gt; add_model(linear_reg() |&gt; set_engine(\"lm\"))\nfinal_mlr_fit &lt;- last_fit(MLR_wkf3, bike_split)\n\n\n\n\n\n# Collect metrics (RMSE and R squared) \ncompare_models &lt;- bind_rows(\n  collect_metrics(final_lasso_fit) |&gt; mutate(model = \"LASSO\"),\n  collect_metrics(final_tree_fit) |&gt; mutate(model = \"Regression Tree\"),\n  collect_metrics(final_bag_fit) |&gt; mutate(model = \"Bagged Tree\"),\n  collect_metrics(final_rf_fit) |&gt; mutate(model = \"Random Forest\"),\n  collect_metrics(final_mlr_fit) |&gt; mutate(model = \"MLR (HW8 Best)\")\n) |&gt;\n  select(model, .metric, .estimate) |&gt;\n  pivot_wider(names_from = .metric, values_from = .estimate)\n\nprint(compare_models)\n\n# A tibble: 5 × 3\n  model             rmse   rsq\n  &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;\n1 LASSO            3551. 0.879\n2 Regression Tree  3629. 0.867\n3 Bagged Tree      2800. 0.921\n4 Random Forest    2760. 0.925\n5 MLR (HW8 Best)  11843. 0.464\n\n\n\n\n\n\n\n\n\n# A. LASSO Coefficient Table \nlasso_coefs &lt;- extract_fit_parsnip(final_lasso_fit) |&gt;\n  tidy() |&gt;\n  filter(estimate != 0)\nprint(lasso_coefs)\n\n# A tibble: 14 × 3\n   term                         estimate      penalty\n   &lt;chr&gt;                           &lt;dbl&gt;        &lt;dbl&gt;\n 1 (Intercept)                   20276.  0.0000000001\n 2 rainfall_sum_mm               -1691.  0.0000000001\n 3 snowfall_sum_cm                -367.  0.0000000001\n 4 temperature_mean_c               62.9 0.0000000001\n 5 humidity_mean_percent         -1171.  0.0000000001\n 6 wind_speed_mean_m_s            -606.  0.0000000001\n 7 visibility_mean_10m            -124.  0.0000000001\n 8 dew_point_temperature_mean_c   4128.  0.0000000001\n 9 solar_radiation_mean_mj_m2     4055.  0.0000000001\n10 seasons_Spring                -4827.  0.0000000001\n11 seasons_Summer                -3511.  0.0000000001\n12 seasons_Winter                -8306.  0.0000000001\n13 holiday_No.Holiday             2702.  0.0000000001\n14 day_type_weekend              -2639.  0.0000000001\n\n# B. Regression Tree Plot \ntree_engine &lt;- extract_fit_engine(final_tree_fit)\nrpart.plot(tree_engine, roundint = FALSE)\n\nWarning: labs do not fit even at cex 0.15, there may be some overplotting\n\n\n\n\n\n\n\n\n# C. Bagged Tree\nbag_engine &lt;- extract_fit_engine(final_bag_fit)\n\nbag_importance &lt;- bag_engine$imp |&gt;\n  select(term, value) |&gt;\n  rename(Variable = term, Importance = value) |&gt;\n  arrange(desc(Importance))\n\n# Plot using ggplot\nbag_plot &lt;- bag_importance |&gt;\n  ggplot(aes(x = reorder(Variable, Importance), y = Importance)) +\n  geom_col(fill = \"black\", alpha = 0.7) +\n  coord_flip() +\n  labs(\n    title = \"Bagged Tree Variable Importance\",\n    x = \"Predictor\",\n    y = \"Importance\"\n  ) +\n  theme_minimal()\n\nprint(bag_plot)\n\n\n\n\n\n\n\n# D. Random Forest\nrf_engine &lt;- extract_fit_engine(final_rf_fit)\n\nrf_importance &lt;- tibble(\n  Variable = names(rf_engine$variable.importance),\n  Importance = rf_engine$variable.importance\n) |&gt;\n  arrange(desc(Importance))\n\nrf_plot &lt;- rf_importance |&gt;\n  ggplot(aes(x = reorder(Variable, Importance), y = Importance)) +\n  geom_col(fill = \"black\", alpha = 0.7) +\n  coord_flip() +\n  labs(\n    title = \"Random Forest Variable Importance\",\n    x = \"Predictor\",\n    y = \"Importance (Impurity)\"\n  ) +\n  theme_minimal()\n\nprint(rf_plot)\n\n\n\n\n\n\n\n\n\n\n\n\nfinal_model_full &lt;- fit(final_rf_wkf, data = bike_data_daily)\n\nprint(final_model_full)\n\n══ Workflow [trained] ══════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: rand_forest()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n5 Recipe Steps\n\n• step_date()\n• step_mutate()\n• step_rm()\n• step_normalize()\n• step_dummy()\n\n── Model ───────────────────────────────────────────────────────────────────────\nRanger result\n\nCall:\n ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~10L,      x), num.trees = ~1000, min.node.size = min_rows(~2L, x),      importance = ~\"impurity\", num.threads = 1, verbose = FALSE,      seed = sample.int(10^5, 1)) \n\nType:                             Regression \nNumber of trees:                  1000 \nSample size:                      353 \nNumber of independent variables:  13 \nMtry:                             10 \nTarget node size:                 2 \nVariable importance mode:         impurity \nSplitrule:                        variance \nOOB prediction error (MSE):       7381252 \nR squared (OOB):                  0.9252511"
  },
  {
    "objectID": "Homework9.html#reading-data-homework8",
    "href": "Homework9.html#reading-data-homework8",
    "title": "ST558 Homework9",
    "section": "",
    "text": "bike_data_raw &lt;- read_csv(\"SeoulBikeData.csv\", \n                          locale = locale(encoding = \"latin1\"))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): Date, Seasons, Holiday, Functioning Day\ndbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message."
  },
  {
    "objectID": "Homework9.html#eda-homework8",
    "href": "Homework9.html#eda-homework8",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# 1. Check for missingness\nprint(colSums(is.na(bike_data_raw)))\n\n                      Date          Rented Bike Count \n                         0                          0 \n                      Hour           Temperature(°C) \n                         0                          0 \n               Humidity(%)           Wind speed (m/s) \n                         0                          0 \n          Visibility (10m) Dew point temperature(°C) \n                         0                          0 \n   Solar Radiation (MJ/m2)               Rainfall(mm) \n                         0                          0 \n             Snowfall (cm)                    Seasons \n                         0                          0 \n                   Holiday            Functioning Day \n                         0                          0 \n\n\nAll columns are 0 : There is no missing.\n\n# 2. Check column types and values\nglimpse(bike_data_raw)\n\nRows: 8,760\nColumns: 14\n$ Date                        &lt;chr&gt; \"01/12/2017\", \"01/12/2017\", \"01/12/2017\", …\n$ `Rented Bike Count`         &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930…\n$ Hour                        &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, …\n$ `Temperature(°C)`           &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, …\n$ `Humidity(%)`               &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24…\n$ `Wind speed (m/s)`          &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.…\n$ `Visibility (10m)`          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, …\n$ `Dew point temperature(°C)` &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, …\n$ `Solar Radiation (MJ/m2)`   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, …\n$ `Rainfall(mm)`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ `Snowfall (cm)`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ Seasons                     &lt;chr&gt; \"Winter\", \"Winter\", \"Winter\", \"Winter\", \"W…\n$ Holiday                     &lt;chr&gt; \"No Holiday\", \"No Holiday\", \"No Holiday\", …\n$ `Functioning Day`           &lt;chr&gt; \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", …\n\nsummary(bike_data_raw |&gt; select(where(is.numeric)))\n\n Rented Bike Count      Hour       Temperature(°C)  Humidity(%)   \n Min.   :   0.0    Min.   : 0.00   Min.   :-17.80   Min.   : 0.00  \n 1st Qu.: 191.0    1st Qu.: 5.75   1st Qu.:  3.50   1st Qu.:42.00  \n Median : 504.5    Median :11.50   Median : 13.70   Median :57.00  \n Mean   : 704.6    Mean   :11.50   Mean   : 12.88   Mean   :58.23  \n 3rd Qu.:1065.2    3rd Qu.:17.25   3rd Qu.: 22.50   3rd Qu.:74.00  \n Max.   :3556.0    Max.   :23.00   Max.   : 39.40   Max.   :98.00  \n Wind speed (m/s) Visibility (10m) Dew point temperature(°C)\n Min.   :0.000    Min.   :  27     Min.   :-30.600           \n 1st Qu.:0.900    1st Qu.: 940     1st Qu.: -4.700           \n Median :1.500    Median :1698     Median :  5.100           \n Mean   :1.725    Mean   :1437     Mean   :  4.074           \n 3rd Qu.:2.300    3rd Qu.:2000     3rd Qu.: 14.800           \n Max.   :7.400    Max.   :2000     Max.   : 27.200           \n Solar Radiation (MJ/m2)  Rainfall(mm)     Snowfall (cm)    \n Min.   :0.0000          Min.   : 0.0000   Min.   :0.00000  \n 1st Qu.:0.0000          1st Qu.: 0.0000   1st Qu.:0.00000  \n Median :0.0100          Median : 0.0000   Median :0.00000  \n Mean   :0.5691          Mean   : 0.1487   Mean   :0.07507  \n 3rd Qu.:0.9300          3rd Qu.: 0.0000   3rd Qu.:0.00000  \n Max.   :3.5200          Max.   :35.0000   Max.   :8.80000  \n\nprint(map(bike_data_raw |&gt; select(where(is.character), -Date), unique))\n\n$Seasons\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\n$Holiday\n[1] \"No Holiday\" \"Holiday\"   \n\n$`Functioning Day`\n[1] \"Yes\" \"No\" \n\n\n\n# 3, 4, 5. Convert Date, Convert to Factors, Rename\nbike_data_cleaned &lt;- bike_data_raw |&gt;\n  mutate(\n    Date = dmy(Date), # 3. Convert the Date column into an actual date \n    Seasons = factor(Seasons), # 4: Turn the character variables \n    Holiday = factor(Holiday), # 4: Turn the character variables \n  ) |&gt;\n  clean_names() |&gt; # 5: Rename all the variables to have easy to use names \n  mutate(\n    functioning_day = factor(functioning_day) # 4: Turn the character variables \n  )\n\nglimpse(bike_data_cleaned)\n\nRows: 8,760\nColumns: 14\n$ date                    &lt;date&gt; 2017-12-01, 2017-12-01, 2017-12-01, 2017-12-0…\n$ rented_bike_count       &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930, 49…\n$ hour                    &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …\n$ temperature_c           &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, -7.4…\n$ humidity_percent        &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24, 21…\n$ wind_speed_m_s          &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.1, 0…\n$ visibility_10m          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000…\n$ dew_point_temperature_c &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, -19.…\n$ solar_radiation_mj_m2   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00…\n$ rainfall_mm             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ snowfall_cm             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ seasons                 &lt;fct&gt; Winter, Winter, Winter, Winter, Winter, Winter…\n$ holiday                 &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday…\n$ functioning_day         &lt;fct&gt; Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Y…\n\n\n\n\n\n\n# 6: Create summary statistics (especially related to the bike rental count)\nprint(\n  bike_data_cleaned |&gt;\n    group_by(functioning_day) |&gt;\n    summarize(\n      count = n(),\n      min_bikes = min(rented_bike_count),\n      mean_bikes = mean(rented_bike_count),\n      max_bikes = max(rented_bike_count)\n    )\n)\n\n# A tibble: 2 × 5\n  functioning_day count min_bikes mean_bikes max_bikes\n  &lt;fct&gt;           &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;\n1 No                295         0         0          0\n2 Yes              8465         2       729.      3556\n\n# 6: Subset the data appropriately\nbike_data_functional &lt;- bike_data_cleaned |&gt;\n  filter(functioning_day == \"Yes\")\n\nsummary(bike_data_functional)\n\n      date            rented_bike_count      hour       temperature_c   \n Min.   :2017-12-01   Min.   :   2.0    Min.   : 0.00   Min.   :-17.80  \n 1st Qu.:2018-02-27   1st Qu.: 214.0    1st Qu.: 6.00   1st Qu.:  3.00  \n Median :2018-05-28   Median : 542.0    Median :12.00   Median : 13.50  \n Mean   :2018-05-28   Mean   : 729.2    Mean   :11.51   Mean   : 12.77  \n 3rd Qu.:2018-08-24   3rd Qu.:1084.0    3rd Qu.:18.00   3rd Qu.: 22.70  \n Max.   :2018-11-30   Max.   :3556.0    Max.   :23.00   Max.   : 39.40  \n humidity_percent wind_speed_m_s  visibility_10m dew_point_temperature_c\n Min.   : 0.00    Min.   :0.000   Min.   :  27   Min.   :-30.600        \n 1st Qu.:42.00    1st Qu.:0.900   1st Qu.: 935   1st Qu.: -5.100        \n Median :57.00    Median :1.500   Median :1690   Median :  4.700        \n Mean   :58.15    Mean   :1.726   Mean   :1434   Mean   :  3.945        \n 3rd Qu.:74.00    3rd Qu.:2.300   3rd Qu.:2000   3rd Qu.: 15.200        \n Max.   :98.00    Max.   :7.400   Max.   :2000   Max.   : 27.200        \n solar_radiation_mj_m2  rainfall_mm       snowfall_cm        seasons    \n Min.   :0.0000        Min.   : 0.0000   Min.   :0.00000   Autumn:1937  \n 1st Qu.:0.0000        1st Qu.: 0.0000   1st Qu.:0.00000   Spring:2160  \n Median :0.0100        Median : 0.0000   Median :0.00000   Summer:2208  \n Mean   :0.5679        Mean   : 0.1491   Mean   :0.07768   Winter:2160  \n 3rd Qu.:0.9300        3rd Qu.: 0.0000   3rd Qu.:0.00000                \n Max.   :3.5200        Max.   :35.0000   Max.   :8.80000                \n       holiday     functioning_day\n Holiday   : 408   No :   0       \n No Holiday:8057   Yes:8465       \n                                  \n                                  \n                                  \n                                  \n\nbike_data_functional_no &lt;- bike_data_cleaned |&gt;\n  filter(functioning_day == \"No\")\n\nsummary(bike_data_functional_no)\n\n      date            rented_bike_count      hour      temperature_c  \n Min.   :2018-04-11   Min.   :0         Min.   : 0.0   Min.   : 5.20  \n 1st Qu.:2018-09-19   1st Qu.:0         1st Qu.: 5.0   1st Qu.:12.30  \n Median :2018-10-02   Median :0         Median :11.0   Median :16.30  \n Mean   :2018-09-12   Mean   :0         Mean   :11.3   Mean   :16.09  \n 3rd Qu.:2018-10-09   3rd Qu.:0         3rd Qu.:17.0   3rd Qu.:19.35  \n Max.   :2018-11-09   Max.   :0         Max.   :23.0   Max.   :26.50  \n humidity_percent wind_speed_m_s  visibility_10m dew_point_temperature_c\n Min.   :21.00    Min.   :0.000   Min.   : 201   Min.   :-7.00          \n 1st Qu.:49.00    1st Qu.:0.900   1st Qu.:1055   1st Qu.: 5.30          \n Median :62.00    Median :1.500   Median :1814   Median : 7.80          \n Mean   :60.49    Mean   :1.697   Mean   :1522   Mean   : 7.77          \n 3rd Qu.:73.00    3rd Qu.:2.350   3rd Qu.:2000   3rd Qu.:11.00          \n Max.   :96.00    Max.   :5.300   Max.   :2000   Max.   :16.10          \n solar_radiation_mj_m2  rainfall_mm       snowfall_cm   seasons   \n Min.   :0.0000        Min.   : 0.0000   Min.   :0    Autumn:247  \n 1st Qu.:0.0000        1st Qu.: 0.0000   1st Qu.:0    Spring: 48  \n Median :0.0000        Median : 0.0000   Median :0    Summer:  0  \n Mean   :0.6048        Mean   : 0.1363   Mean   :0    Winter:  0  \n 3rd Qu.:1.0650        3rd Qu.: 0.0000   3rd Qu.:0                \n Max.   :3.3200        Max.   :18.0000   Max.   :0                \n       holiday    functioning_day\n Holiday   : 24   No :295        \n No Holiday:271   Yes:  0        \n                                 \n                                 \n                                 \n                                 \n\n\nIf the bike is not functioning, the rented bike count is always 0.\nSo we will focus on the data where the bike is functioning for further analysis.\n\n# 7: To simplify our analysis, we’ll summarize across the hours\nbike_data_daily &lt;- bike_data_functional |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(\n    # Find the sum of rented_bike_count, rainfall, and snowfall\n    rented_bike_count_sum = sum(rented_bike_count),\n    rainfall_sum_mm = sum(rainfall_mm),\n    snowfall_sum_cm = sum(snowfall_cm),\n    \n    # Find the mean of all the weather related variables\n    temperature_mean_c = mean(temperature_c),\n    humidity_mean_percent = mean(humidity_percent),\n    wind_speed_mean_m_s = mean(wind_speed_m_s),\n    visibility_mean_10m = mean(visibility_10m),\n    dew_point_temperature_mean_c = mean(dew_point_temperature_c),\n    solar_radiation_mean_mj_m2 = mean(solar_radiation_mj_m2),\n    \n    .groups = 'drop' \n  )\n\nglimpse(bike_data_daily)\n\nRows: 353\nColumns: 12\n$ date                         &lt;date&gt; 2017-12-01, 2017-12-02, 2017-12-03, 2017…\n$ seasons                      &lt;fct&gt; Winter, Winter, Winter, Winter, Winter, W…\n$ holiday                      &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Ho…\n$ rented_bike_count_sum        &lt;dbl&gt; 9539, 8523, 7222, 8729, 8307, 6669, 8549,…\n$ rainfall_sum_mm              &lt;dbl&gt; 0.0, 0.0, 4.0, 0.1, 0.0, 1.3, 0.0, 0.0, 0…\n$ snowfall_sum_cm              &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 8.6, 10.4, 0.0, …\n$ temperature_mean_c           &lt;dbl&gt; -2.45416667, 1.32500000, 4.87500000, -0.3…\n$ humidity_mean_percent        &lt;dbl&gt; 45.87500, 61.95833, 81.54167, 52.50000, 3…\n$ wind_speed_mean_m_s          &lt;dbl&gt; 1.5375000, 1.7125000, 1.6125000, 3.450000…\n$ visibility_mean_10m          &lt;dbl&gt; 1870.7500, 1471.0833, 455.7500, 1362.8333…\n$ dew_point_temperature_mean_c &lt;dbl&gt; -13.5458333, -5.7166667, 1.8833333, -9.92…\n$ solar_radiation_mean_mj_m2   &lt;dbl&gt; 0.24875000, 0.26375000, 0.12541667, 0.282…\n\n\n\n# 8: Recreate my basic summary stats\nsummary(bike_data_daily)\n\n      date              seasons         holiday    rented_bike_count_sum\n Min.   :2017-12-01   Autumn:81   Holiday   : 17   Min.   :  977        \n 1st Qu.:2018-02-27   Spring:90   No Holiday:336   1st Qu.: 6967        \n Median :2018-05-28   Summer:92                    Median :18563        \n Mean   :2018-05-28   Winter:90                    Mean   :17485        \n 3rd Qu.:2018-08-24                                3rd Qu.:26285        \n Max.   :2018-11-30                                Max.   :36149        \n rainfall_sum_mm  snowfall_sum_cm  temperature_mean_c humidity_mean_percent\n Min.   : 0.000   Min.   : 0.000   Min.   :-14.738    Min.   :22.25        \n 1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.:  3.304    1st Qu.:47.58        \n Median : 0.000   Median : 0.000   Median : 13.738    Median :57.17        \n Mean   : 3.576   Mean   : 1.863   Mean   : 12.776    Mean   :58.17        \n 3rd Qu.: 0.500   3rd Qu.: 0.000   3rd Qu.: 22.592    3rd Qu.:67.71        \n Max.   :95.500   Max.   :78.700   Max.   : 33.742    Max.   :95.88        \n wind_speed_mean_m_s visibility_mean_10m dew_point_temperature_mean_c\n Min.   :0.6625      Min.   : 214.3      Min.   :-27.750             \n 1st Qu.:1.3042      1st Qu.:1087.0      1st Qu.: -5.188             \n Median :1.6583      Median :1557.8      Median :  4.612             \n Mean   :1.7261      Mean   :1434.0      Mean   :  3.954             \n 3rd Qu.:1.9542      3rd Qu.:1874.3      3rd Qu.: 14.921             \n Max.   :4.0000      Max.   :2000.0      Max.   : 25.038             \n solar_radiation_mean_mj_m2\n Min.   :0.02917           \n 1st Qu.:0.28333           \n Median :0.56500           \n Mean   :0.56773           \n 3rd Qu.:0.82000           \n Max.   :1.21667           \n\n# Plot: Rented Bike Count vs. Mean Temperature\nplot_temp &lt;- bike_data_daily |&gt;\n  ggplot(aes(x = temperature_mean_c , y = rented_bike_count_sum)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"blue\") +\n  labs(\n    title = \"Daily Bike Rentals vs. Mean Temperature\",\n    x = \"Mean Temperature (C)\",\n    y = \"Sum of Daily Bike Rentals\"\n  )\nprint(plot_temp)\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\n\n\n\n\n\n\n#  correlation between my numeric variables\ncor_matrix &lt;- bike_data_daily |&gt;\n  select(where(is.numeric)) |&gt;\n  cor()\nprint(round(cor_matrix, 2))\n\n                             rented_bike_count_sum rainfall_sum_mm\nrented_bike_count_sum                         1.00           -0.24\nrainfall_sum_mm                              -0.24            1.00\nsnowfall_sum_cm                              -0.27           -0.02\ntemperature_mean_c                            0.75            0.14\nhumidity_mean_percent                         0.04            0.53\nwind_speed_mean_m_s                          -0.19           -0.10\nvisibility_mean_10m                           0.17           -0.22\ndew_point_temperature_mean_c                  0.65            0.26\nsolar_radiation_mean_mj_m2                    0.74           -0.32\n                             snowfall_sum_cm temperature_mean_c\nrented_bike_count_sum                  -0.27               0.75\nrainfall_sum_mm                        -0.02               0.14\nsnowfall_sum_cm                         1.00              -0.27\ntemperature_mean_c                     -0.27               1.00\nhumidity_mean_percent                   0.07               0.40\nwind_speed_mean_m_s                     0.02              -0.26\nvisibility_mean_10m                    -0.10               0.00\ndew_point_temperature_mean_c           -0.21               0.96\nsolar_radiation_mean_mj_m2             -0.23               0.55\n                             humidity_mean_percent wind_speed_mean_m_s\nrented_bike_count_sum                         0.04               -0.19\nrainfall_sum_mm                               0.53               -0.10\nsnowfall_sum_cm                               0.07                0.02\ntemperature_mean_c                            0.40               -0.26\nhumidity_mean_percent                         1.00               -0.23\nwind_speed_mean_m_s                          -0.23                1.00\nvisibility_mean_10m                          -0.56                0.21\ndew_point_temperature_mean_c                  0.63               -0.29\nsolar_radiation_mean_mj_m2                   -0.27                0.10\n                             visibility_mean_10m dew_point_temperature_mean_c\nrented_bike_count_sum                       0.17                         0.65\nrainfall_sum_mm                            -0.22                         0.26\nsnowfall_sum_cm                            -0.10                        -0.21\ntemperature_mean_c                          0.00                         0.96\nhumidity_mean_percent                      -0.56                         0.63\nwind_speed_mean_m_s                         0.21                        -0.29\nvisibility_mean_10m                         1.00                        -0.15\ndew_point_temperature_mean_c               -0.15                         1.00\nsolar_radiation_mean_mj_m2                  0.27                         0.38\n                             solar_radiation_mean_mj_m2\nrented_bike_count_sum                              0.74\nrainfall_sum_mm                                   -0.32\nsnowfall_sum_cm                                   -0.23\ntemperature_mean_c                                 0.55\nhumidity_mean_percent                             -0.27\nwind_speed_mean_m_s                                0.10\nvisibility_mean_10m                                0.27\ndew_point_temperature_mean_c                       0.38\nsolar_radiation_mean_mj_m2                         1.00"
  },
  {
    "objectID": "Homework9.html#split-the-data-homework8",
    "href": "Homework9.html#split-the-data-homework8",
    "title": "ST558 Homework9",
    "section": "",
    "text": "set.seed(10)\nbike_split &lt;- initial_split(bike_data_daily, prop = 0.75, strata = seasons)\nbike_train &lt;- training(bike_split)\nbike_test &lt;- testing(bike_split)\nbike_CV_folds &lt;- vfold_cv(bike_train, v = 10, strata = seasons)"
  },
  {
    "objectID": "Homework9.html#mlr-recipe-homework8",
    "href": "Homework9.html#mlr-recipe-homework8",
    "title": "ST558 Homework9",
    "section": "",
    "text": "MLR_recipe1 &lt;- recipe(rented_bike_count_sum ~ ., data = bike_train) |&gt;\n  # Ignore the date variable for modeling\n  step_date(date, features = c(\"dow\")) |&gt;\n  step_mutate(day_type = factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"), \n                                        \"weekend\", \"weekday\"))) |&gt;\n  step_rm(date, date_dow) |&gt; \n  # Standardize the numeric variables since their scales are pretty different.\n  step_normalize(all_numeric_predictors()) |&gt;\n  # Create dummy variables for the seasons, holiday, and our new day type variable\n  step_dummy(all_nominal_predictors())"
  },
  {
    "objectID": "Homework9.html#model-specifications",
    "href": "Homework9.html#model-specifications",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# A. LASSO Model\nlasso_spec &lt;- linear_reg(penalty = tune(), mixture = 1) |&gt;\n  set_engine(\"glmnet\")\n\n# B. Regression Tree Model\ntree_spec &lt;- decision_tree(cost_complexity = tune(), tree_depth = tune(), min_n = tune()) |&gt;\n  set_engine(\"rpart\") |&gt;\n  set_mode(\"regression\")\n\n# C. Bagged Tree Model\nbag_spec &lt;- bag_tree(cost_complexity = tune(), tree_depth = tune(), min_n = tune()) |&gt;\n  set_engine(\"rpart\", times = 50) |&gt;\n  set_mode(\"regression\")\n\n# D. Random Forest Model\nrf_spec &lt;- rand_forest(mtry = tune(), min_n = tune(), trees = 1000) |&gt;\n  set_engine(\"ranger\", importance = \"impurity\") |&gt;\n  set_mode(\"regression\")"
  },
  {
    "objectID": "Homework9.html#workflows",
    "href": "Homework9.html#workflows",
    "title": "ST558 Homework9",
    "section": "",
    "text": "lasso_wkf &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(lasso_spec)\ntree_wkf  &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(tree_spec)\nbag_wkf   &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(bag_spec)\nrf_wkf    &lt;- workflow() |&gt; add_recipe(MLR_recipe1) |&gt; add_model(rf_spec)"
  },
  {
    "objectID": "Homework9.html#tuning",
    "href": "Homework9.html#tuning",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# Setting up grids\nlasso_grid &lt;- grid_regular(penalty(), levels = 50)\ntree_grid  &lt;- grid_regular(cost_complexity(), tree_depth(), min_n(), levels = 5)\nbag_grid   &lt;- grid_regular(cost_complexity(), tree_depth(), min_n(), levels = 5)\nrf_grid    &lt;- grid_regular(mtry(range = c(1, 10)), min_n(), levels = 5)\n\n# Tune Models\nlasso_res &lt;- tune_grid(lasso_wkf, resamples = bike_CV_folds, grid = lasso_grid)\ntree_res  &lt;- tune_grid(tree_wkf,  resamples = bike_CV_folds, grid = tree_grid)\nbag_res   &lt;- tune_grid(bag_wkf,   resamples = bike_CV_folds, grid = bag_grid)\n\nRegistered S3 method overwritten by 'butcher':\n  method                 from    \n  as.character.dev_topic generics\n\n\n→ A | warning: There was 1 warning in `dplyr::mutate()`.\n               ℹ In argument: `model = iter(...)`.\n               Caused by warning:\n               ! package 'future' was built under R version 4.5.2\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\nrf_res    &lt;- tune_grid(rf_wkf,    resamples = bike_CV_folds, grid = rf_grid)"
  },
  {
    "objectID": "Homework9.html#workflows-1",
    "href": "Homework9.html#workflows-1",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# Select best parameters for each model \nbest_lasso &lt;- select_best(lasso_res, metric = \"rmse\")\nfinal_lasso_wkf &lt;- finalize_workflow(lasso_wkf, best_lasso)\nfinal_lasso_fit &lt;- last_fit(final_lasso_wkf, bike_split)\n\nbest_tree  &lt;- select_best(tree_res, metric = \"rmse\")\nfinal_tree_wkf  &lt;- finalize_workflow(tree_wkf, best_tree)\nfinal_tree_fit  &lt;- last_fit(final_tree_wkf, bike_split)\n\nbest_bag   &lt;- select_best(bag_res, metric = \"rmse\")\nfinal_bag_wkf   &lt;- finalize_workflow(bag_wkf, best_bag) \nfinal_bag_fit   &lt;- last_fit(final_bag_wkf, bike_split)\n\nbest_rf    &lt;- select_best(rf_res, metric = \"rmse\")\nfinal_rf_wkf    &lt;- finalize_workflow(rf_wkf, best_rf)\nfinal_rf_fit    &lt;- last_fit(final_rf_wkf, bike_split)"
  },
  {
    "objectID": "Homework9.html#best-mlr-model-homework8",
    "href": "Homework9.html#best-mlr-model-homework8",
    "title": "ST558 Homework9",
    "section": "",
    "text": "MLR_recipe3 &lt;- MLR_recipe1 |&gt;\n  step_interact(~ starts_with(\"seasons_\"):starts_with(\"holiday_\")) |&gt;\n  step_interact(~ starts_with(\"seasons_\"):temperature_mean_c) |&gt;\n  step_interact(~ temperature_mean_c:rainfall_sum_mm) |&gt;\n  step_poly(rainfall_sum_mm, snowfall_sum_cm, temperature_mean_c, humidity_mean_percent,\n            wind_speed_mean_m_s, visibility_mean_10m, dew_point_temperature_mean_c,\n            solar_radiation_mean_mj_m2, degree = 2)\n\nMLR_wkf3 &lt;- workflow() |&gt; add_recipe(MLR_recipe3) |&gt; add_model(linear_reg() |&gt; set_engine(\"lm\"))\nfinal_mlr_fit &lt;- last_fit(MLR_wkf3, bike_split)"
  },
  {
    "objectID": "Homework9.html#comparison",
    "href": "Homework9.html#comparison",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# Collect metrics (RMSE and R squared) \ncompare_models &lt;- bind_rows(\n  collect_metrics(final_lasso_fit) |&gt; mutate(model = \"LASSO\"),\n  collect_metrics(final_tree_fit) |&gt; mutate(model = \"Regression Tree\"),\n  collect_metrics(final_bag_fit) |&gt; mutate(model = \"Bagged Tree\"),\n  collect_metrics(final_rf_fit) |&gt; mutate(model = \"Random Forest\"),\n  collect_metrics(final_mlr_fit) |&gt; mutate(model = \"MLR (HW8 Best)\")\n) |&gt;\n  select(model, .metric, .estimate) |&gt;\n  pivot_wider(names_from = .metric, values_from = .estimate)\n\nprint(compare_models)\n\n# A tibble: 5 × 3\n  model             rmse   rsq\n  &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt;\n1 LASSO            3551. 0.879\n2 Regression Tree  3629. 0.867\n3 Bagged Tree      2800. 0.921\n4 Random Forest    2760. 0.925\n5 MLR (HW8 Best)  11843. 0.464"
  },
  {
    "objectID": "Homework9.html#report",
    "href": "Homework9.html#report",
    "title": "ST558 Homework9",
    "section": "",
    "text": "# A. LASSO Coefficient Table \nlasso_coefs &lt;- extract_fit_parsnip(final_lasso_fit) |&gt;\n  tidy() |&gt;\n  filter(estimate != 0)\nprint(lasso_coefs)\n\n# A tibble: 14 × 3\n   term                         estimate      penalty\n   &lt;chr&gt;                           &lt;dbl&gt;        &lt;dbl&gt;\n 1 (Intercept)                   20276.  0.0000000001\n 2 rainfall_sum_mm               -1691.  0.0000000001\n 3 snowfall_sum_cm                -367.  0.0000000001\n 4 temperature_mean_c               62.9 0.0000000001\n 5 humidity_mean_percent         -1171.  0.0000000001\n 6 wind_speed_mean_m_s            -606.  0.0000000001\n 7 visibility_mean_10m            -124.  0.0000000001\n 8 dew_point_temperature_mean_c   4128.  0.0000000001\n 9 solar_radiation_mean_mj_m2     4055.  0.0000000001\n10 seasons_Spring                -4827.  0.0000000001\n11 seasons_Summer                -3511.  0.0000000001\n12 seasons_Winter                -8306.  0.0000000001\n13 holiday_No.Holiday             2702.  0.0000000001\n14 day_type_weekend              -2639.  0.0000000001\n\n# B. Regression Tree Plot \ntree_engine &lt;- extract_fit_engine(final_tree_fit)\nrpart.plot(tree_engine, roundint = FALSE)\n\nWarning: labs do not fit even at cex 0.15, there may be some overplotting\n\n\n\n\n\n\n\n\n# C. Bagged Tree\nbag_engine &lt;- extract_fit_engine(final_bag_fit)\n\nbag_importance &lt;- bag_engine$imp |&gt;\n  select(term, value) |&gt;\n  rename(Variable = term, Importance = value) |&gt;\n  arrange(desc(Importance))\n\n# Plot using ggplot\nbag_plot &lt;- bag_importance |&gt;\n  ggplot(aes(x = reorder(Variable, Importance), y = Importance)) +\n  geom_col(fill = \"black\", alpha = 0.7) +\n  coord_flip() +\n  labs(\n    title = \"Bagged Tree Variable Importance\",\n    x = \"Predictor\",\n    y = \"Importance\"\n  ) +\n  theme_minimal()\n\nprint(bag_plot)\n\n\n\n\n\n\n\n# D. Random Forest\nrf_engine &lt;- extract_fit_engine(final_rf_fit)\n\nrf_importance &lt;- tibble(\n  Variable = names(rf_engine$variable.importance),\n  Importance = rf_engine$variable.importance\n) |&gt;\n  arrange(desc(Importance))\n\nrf_plot &lt;- rf_importance |&gt;\n  ggplot(aes(x = reorder(Variable, Importance), y = Importance)) +\n  geom_col(fill = \"black\", alpha = 0.7) +\n  coord_flip() +\n  labs(\n    title = \"Random Forest Variable Importance\",\n    x = \"Predictor\",\n    y = \"Importance (Impurity)\"\n  ) +\n  theme_minimal()\n\nprint(rf_plot)"
  },
  {
    "objectID": "Homework9.html#fit-the-best-modelrandom-forest-on-the-full-dataset",
    "href": "Homework9.html#fit-the-best-modelrandom-forest-on-the-full-dataset",
    "title": "ST558 Homework9",
    "section": "",
    "text": "final_model_full &lt;- fit(final_rf_wkf, data = bike_data_daily)\n\nprint(final_model_full)\n\n══ Workflow [trained] ══════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: rand_forest()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n5 Recipe Steps\n\n• step_date()\n• step_mutate()\n• step_rm()\n• step_normalize()\n• step_dummy()\n\n── Model ───────────────────────────────────────────────────────────────────────\nRanger result\n\nCall:\n ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~10L,      x), num.trees = ~1000, min.node.size = min_rows(~2L, x),      importance = ~\"impurity\", num.threads = 1, verbose = FALSE,      seed = sample.int(10^5, 1)) \n\nType:                             Regression \nNumber of trees:                  1000 \nSample size:                      353 \nNumber of independent variables:  13 \nMtry:                             10 \nTarget node size:                 2 \nVariable importance mode:         impurity \nSplitrule:                        variance \nOOB prediction error (MSE):       7381252 \nR squared (OOB):                  0.9252511"
  }
]